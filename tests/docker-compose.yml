version: "3.3"
services:
  go-build:
    # Base Image: https://hub.docker.com/r/library/golang/
    container_name: "go-build"
    build:
      context: ..
      dockerfile: ./tests/Dockerfile
    entrypoint: ["tail", "-f", "/dev/null"]
    volumes:
      - type: volume
        source: go_output
        target: go/out_syslog.so
  fluent-bit:
    container_name: "fluent-bit"
    image: oratos/fluent-bit-out-syslog
    # TODO: enable people to build local out_syslog.so
    command: /fluent-bit/bin/fluent-bit --plugin /fluent-bit/bin/out_syslog.so --config /fluent-bit/etc/fluent-bit.conf -i dummy -o syslog --prop Addr=syslog:12345 -f 1
    depends_on:
      - go-build
  syslog:
    container_name: "syslog-server"
    # Docker image: https://github.com/jasonkeene/tcp-to-stdout
    image: jasonkeene/tcp-to-stdout
    environment:
      ADDR: :12345
